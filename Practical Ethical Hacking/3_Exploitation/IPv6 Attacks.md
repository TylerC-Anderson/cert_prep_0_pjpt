
## Quick-Use

*NOTE*: `mitm6` should NOT be ran for more than 5-10 minute sprints, because it can overwhelm and DOS the network

**Commands**:
- USED AS PAIR:
    - First - `ntlmrelayx.py -6 -t ldaps://DCCTRLLRIPADDR -wh fakewpad.marvel.local -l lootme`
    - Then  - `sudo mitm6 -d marvel.local`


**Tools**:
- `NTLMrelayx`
- `Mitm6`

## General

**Defenses**:

1. IPv6 poisoning abuses the fact that Windows queries for an IPv6 address in IPv4 envs. If IPv6 is not used internally, the safest way to defend is to block DHCPv6 traffic and incoming router advertisements in Windows firewall via group policies. DISABLING IPv6 MAY HAVE UNWANTED SIDE EFFECTS, NOT RECOMMENDED
    - Set the following blocks:
        1. (Inbound) Core Networking - Dynamic Host Configuration Protocol for IPv6(DHCPV6-In)
        2. (Inbound) Core Networking - Router Advertisement (ICMPv6-In)
        3. (Outbound) Core networking - Dynamic Host Configuration Protocol for IPv6(DHCPV6- Out)
2. If wpad is not in use internally, disable via Group Policy and by disabling the WinHttpAutoProxySvc service
3. Relaying to LDAP and LDAPS can only be mitigated by enabling both LDAP signing and LDAP channel binding.
4. Consider moving Administrative users to the Protected Users group or marking them as `Account is sensitive and cannot be delegated`, which will precent and impersonation of that user via delegation.

**Objectives**:

May heavily enumerate a DC environment, like this:
![[2_Studies/Courses/Current/CERTPREP - PJPT-Practical Jr Pen Tester/Practical Ethical Hacking/3_Exploitation/z_attachments/Pasted image 20251107203217.png|1000]]

**Overview**:
Because IPv6 is often enabled but not configured, there is no system set up to handle DNS for the user, making IPv6 susceptible to MITM attacks. These attacks may be done by LDAP or SMB relaying of the NTLM request, much like in [[2_Studies/Courses/Current/CERTPREP - PJPT-Practical Jr Pen Tester/Practical Ethical Hacking/3_Exploitation/LLMNR Poisoning]].
## Glossary